<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Colloquium â€” Futuristic Split + Dashboard (Liquid Glass V4 - Extreme)</title>

<style>
/* ================================
  GLOBAL & BASE STYLES
================================
*/
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,system-ui}
html,body{height:100%}
/* Deepest background for floating effect */
body{background:#050012;color:#fff;overflow:hidden;display:flex} 

h1, h2, h3 {text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);} 
button {cursor:pointer;}
button:focus, input:focus, textarea:focus {outline: 2px solid #8b2df5; outline-offset: 2px;}

/* ================================
  LIQUID GLASS BUTTONS (EXTREME V4)
================================
*/
.liquid-btn {
    border: none;
    font-weight: 600;
    padding: 14px 20px;
    border-radius: 14px; 
    color: #fff;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    
    /* Core Glass Effect - MAX BLUR */
    background: rgba(255, 255, 255, 0.15); /* Light, translucent base */
    backdrop-filter: blur(50px) saturate(2); /* EXTREME BLUR */
    border: 1px solid rgba(255, 255, 255, 0.4); /* Stronger white border */
    /* Inner/Outer Shadow for Depth */
    box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.15), 0 6px 25px rgba(0, 0, 0, 0.5);
}

/* Primary Button (Main action: Login, Post, Join) */
.liquid-btn-primary {
    /* Base color is now mostly defined by .liquid-btn, only adding a subtle tint here */
    background: rgba(139, 45, 245, 0.1); 
    border-color: rgba(139, 45, 245, 0.6);
}
.liquid-btn-primary:hover {
    background: rgba(139, 45, 245, 0.8); /* Solid color on hover */
    box-shadow: 0 6px 20px rgba(139, 45, 245, 0.6);
    transform: translateY(-2px); /* Increased lift */
}
.liquid-btn-primary:active {
    background: rgba(139, 45, 245, 1);
    transform: scale(0.98);
}

/* Secondary Button (Create Account, View Feed, Create Group) */
.liquid-btn-secondary {
    background: rgba(90, 32, 184, 0.05); /* Very faint secondary tint */
    border-color: rgba(120, 0, 190, 0.3);
}
.liquid-btn-secondary:hover {
    background: rgba(90, 32, 184, 0.5);
    transform: translateY(-2px);
}
.liquid-btn-secondary:active {
    background: rgba(90, 32, 184, 0.8);
    transform: scale(0.98);
}

/* Danger Button (Logout) */
.liquid-btn-danger {
    background: rgba(228, 30, 38, 0.1); 
    border-color: rgba(228, 30, 38, 0.5);
}
.liquid-btn-danger:hover {
    background: rgba(228, 30, 38, 0.8);
    box-shadow: 0 6px 20px rgba(228, 30, 38, 0.6);
    transform: translateY(-2px);
}
.liquid-btn-danger:active {
    background: rgba(228, 30, 38, 1);
    transform: scale(0.98);
}


/* Small Group Buttons (Join/View in list) - Adjust for visibility */
.group-btn {
    border: none; 
    font-weight: 700;
    padding: 8px 14px;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.3s ease;
    backdrop-filter: blur(25px) saturate(2); /* Max blur for small buttons */
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}
.group-btn.join-btn {
    background: rgba(139, 45, 245, 0.2);
    color: #fff;
}
.group-btn.join-btn:hover {
    background: rgba(139, 45, 245, 0.6);
}
.group-btn.view-btn {
    background: rgba(90, 32, 184, 0.1);
    color: #e0baff;
}
.group-btn.view-btn:hover {
    background: rgba(90, 32, 184, 0.5);
}


/* ================================
  LOGIN & SIGNUP SCREENS
================================
*/
.split{display:flex;width:100%;height:100vh}
.left{width:50%;display:flex;justify-content:center;align-items:center;position:relative}

.glass-card{
    width:360px;
    padding:35px; 
    border-radius:24px; 
    background:rgba(255,255,255,0.06); 
    backdrop-filter:blur(20px); 
    border:1px solid rgba(255,255,255,0.1); 
    box-shadow:0 10px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.05); 
    position:relative;
    z-index:5;
}
.glass-card h2{text-align:center;margin-bottom:25px;color:#e7dfff; font-weight: 700;}
.glass-card input{
    width:100%;
    padding:14px; 
    margin:12px 0;
    border-radius:12px; 
    border:none;
    background:#f0f0f0; 
    color:#111;
    transition: box-shadow 0.2s;
}
.glass-card input:focus {
    box-shadow: 0 0 0 3px #8b2df5;
}
.glass-card .link{text-align:center;margin-top:15px;color:#d9b8ff;cursor:pointer}

/* LEFT SIDE FLOATING BLOBS (CRITICAL FOR EFFECT VISIBILITY) */
.left .blob{position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(175,70,255,0.7),rgba(120,0,190,0.3));filter:blur(100px);animation:float 16s infinite ease-in-out}
.blob.one{top:-80px;left:-100px}
.blob.two{bottom:-100px;right:-80px;animation-duration:22s}
.blob.three{top:40%;left:30%;animation-duration:28s;width:350px;height:350px}

@keyframes float{0%{transform:translate(0,0)}50%{transform:translate(60px,-70px)}100%{transform:translate(0,0)}}

/* RIGHT: Futuristic Text */
.right{width:50%;display:flex;flex-direction:column;justify-content:center;padding-left:60px;text-align:left}
.right h1{font-size:64px;font-weight:900;color:#f4e8ff;text-shadow:0 8px 30px rgba(0,0,0,0.4)}
.right p{font-size:20px;margin-top:10px;color:#c8b3ff}

/* ================================
  DASHBOARD STYLES
================================
*/
#dashboard{
    display:none;
    position:absolute;
    inset:0;
    background:transparent;
    padding-top: 100px; 
    overflow-y:auto;
} 
.container-wrap {
    max-width: 1300px; 
    margin: 0 auto;
    padding: 0 30px;
}

/* STICKY HEADER */
.dashboard-header{
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10;
    background: rgba(5, 0, 18, 0.9); 
    backdrop-filter: blur(10px);
    padding: 20px 50px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}
.dashboard-header h2{font-size:28px; font-weight: 800;}

/* Top Search Bar Style */
#topSearchBar {
    width: 100%;
    max-width: 850px; 
    margin: 0 auto 40px auto; 
    padding: 0 10px; 
}
#groupSearchInput {
    padding: 18px 25px; 
    border-radius: 40px; 
    border: 1px solid rgba(139, 45, 245, 0.3);
    background: #fff;
    color: #111;
    width: 100%;
    font-size: 18px;
    box-shadow: 0 5px 20px rgba(139, 45, 245, 0.2); 
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}
#groupSearchInput:focus {
    box-shadow: 0 0 0 3px #8b2df5, 0 5px 30px rgba(139, 45, 245, 0.4);
    border-color: #8b2df5;
}

/* CONTENT GRID */
.columns{
    display:grid;
    grid-template-columns: 1fr 340px; 
    gap:30px; 
}

/* Dashboard Card Style */
.dashboard-card{
    background: rgba(255, 255, 255, 0.05); 
    backdrop-filter: blur(18px); 
    border: 1px solid rgba(255, 255, 255, 0.1); 
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4), inset 0 0 0 1px rgba(255,255,255,0.05); 
    padding:25px; 
    border-radius:20px; 
    margin-bottom:30px; 
    transition: all 0.3s ease;
}
.dashboard-card:hover {
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255,255,255,0.1);
}

.dashboard-card h3{margin-bottom:15px;font-size:22px; font-weight: 600;}

/* Create Post Card - Distinct style */
#createPostCard {
    background: rgba(139, 45, 245, 0.1); 
    border: 1px solid rgba(139, 45, 245, 0.3);
    box-shadow: 0 0 50px rgba(139, 45, 245, 0.3); 
    margin-bottom: 30px;
}
#createPostCard h3 {
    color: #e0baff;
}

/* Input/Textarea style */
textarea{
    width:100%;
    border:none;
    border-radius:12px;
    padding:15px;
    background:#fff;
    color:#111;
    font-size: 16px;
    resize: none; 
    transition: box-shadow 0.2s;
}
textarea:focus {
    box-shadow: 0 0 0 3px #8b2df5;
}

/* Group list item styles */
#communityList li{
    list-style:none;
    padding:12px 15px;
    border-radius:10px;
    background:rgba(255,255,255,0.08); 
    margin-top:10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 5px solid transparent;
    transition: all 0.2s ease;
}
#communityList li:hover{
    background:rgba(255,255,255,0.15);
    border-left: 5px solid #8b2df5; 
}

/* Post style */
.post{
    background:rgba(255,255,255,0.06); 
    padding:15px; 
    border-radius:15px;
    margin-bottom:15px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: background 0.2s ease; 
}
.post:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* small responsive */
@media (max-width:900px){
  .split{flex-direction:column;height:auto}
  .left,.right{width:100%}
  #dashboard{position:static;height:auto; padding-top: 80px;}
  .dashboard-header {position: static; padding: 15px 20px;}
  .columns{grid-template-columns:1fr; max-width: 100%;}
  .container-wrap {padding: 0 15px;}
}
</style>
</head>

<body>

<div class="split" id="loginScreen">
  <div class="left">
    <div class="blob one"></div>
    <div class="blob two"></div>
    <div class="blob three"></div>

    <div class="glass-card">
      <h2>Welcome Back</h2>
      <input id="email" placeholder="Email or phone number">
      <input id="password" type="password" placeholder="Password">
      <button id="loginBtn" class="liquid-btn liquid-btn-primary" style="width:100%; margin-top:15px;">Log In</button>
      <div id="forgotPassword" class="link">Forgot your password?</div>
      <button id="createAccountBtn" class="liquid-btn liquid-btn-secondary" style="width:100%; margin-top:14px">Create an Account</button>
    </div>
  </div>

  <div class="right">
    <h1>Colloquium</h1>
    <p>Empowering the future of collaboration with next-gen design.</p>
  </div>
</div>

<div class="split" id="signupScreen" style="display:none">
    <div class="left">
        <div class="blob one"></div>
        <div class="blob two"></div>
        <div class="blob three"></div>
    
        <div class="glass-card">
          <h2>Create an account</h2>
          <input id="signupName" placeholder="Nickname">
          <input id="signupEmail" placeholder="Email">
          <input id="signupPass" type="password" placeholder="Password">
          <input id="signupConfirm" type="password" placeholder="Confirm password">
          <button id="signupSubmit" class="liquid-btn liquid-btn-primary" style="width:100%;">Sign Up</button>
          <button id="signupClose" class="liquid-btn liquid-btn-secondary" style="width:100%; margin-top:10px">Back to Login</button>
        </div>
    </div>
    <div class="right">
        <h1>Join the Future</h1>
        <p>Unlock new dimensions of learning and collaboration.</p>
    </div>
</div>

<div id="dashboard" aria-hidden="true">
  <div class="dashboard-header">
    <h2>Welcome, <span id="userEmail"></span>!</h2>
    <div>
      <button id="logoutBtn" class="liquid-btn liquid-btn-danger" style="padding: 10px 18px; font-weight: 600;">Log Out</button>
    </div>
  </div>

  <div class="container-wrap">
    
    <div id="topSearchBar">
        <input id="groupSearchInput" placeholder="Search for groups, topics, or people...">
    </div>

    <div class="columns">

      <div>
        <div id="createPostCard" class="dashboard-card" style="display:none;">
          <h3>Create Post to <span id="feedTitle"></span></h3>
          <textarea id="postContent" rows="3" placeholder="What's on your mind?"></textarea>
          <button id="postBtn" class="liquid-btn liquid-btn-primary" style="width:100%; margin-top:15px; padding: 14px;">Post</button>
        </div>

        <div id="mainContent" class="dashboard-card" style="display:none;">
          <h3>Recent Feed</h3>
          <div id="feed">
             <p style="opacity: 0.7;">No posts yet. Be the first to start the conversation!</p>
          </div>
        </div>
      </div>

      <div>
        <div class="dashboard-card">
          <h3>My Study Groups</h3>
          
          <button id="createGroup" class="liquid-btn liquid-btn-secondary" style="width:100%; padding:12px; margin-top: 15px;">Create Group</button>
          <ul id="communityList">
              </ul>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
/* ========= JS (Functionality remains the same) ========= */

/* Storage initialization */
if(!localStorage.getItem('users')) {
  localStorage.setItem('users', JSON.stringify([
    { name: 'Demo User', email: 'demo@colloquium.com', password: 'password' }
  ]));
}
if(!localStorage.getItem('posts')) localStorage.setItem('posts', JSON.stringify([]));
if(!localStorage.getItem('communities')) localStorage.setItem('communities', JSON.stringify(['Global Forum', 'Example Group', 'Math Wizards', 'Code Geeks', 'Design Masters']));
if(!localStorage.getItem('userGroups')) localStorage.setItem('userGroups', JSON.stringify({'Global Forum': ['demo@colloquium.com']}));

/* Helpers */
const $ = (id)=>document.getElementById(id);
function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
function saveUsers(u){ localStorage.setItem('users', JSON.stringify(u)); }
function getPosts(){ return JSON.parse(localStorage.getItem('posts')||'[]'); }
function savePosts(p){ localStorage.setItem('posts', JSON.stringify(p)); }
function getCommunities(){ return JSON.parse(localStorage.getItem('communities')||'[]'); }
function saveCommunities(c){ localStorage.setItem('communities', JSON.stringify(c)); }
function getUserGroups(){ return JSON.parse(localStorage.getItem('userGroups')||'{}'); }
function saveUserGroups(ug){ localStorage.setItem('userGroups', JSON.stringify(ug)); }

let currentUser = null;
let currentGroup = null;

/* --- UI elements --- */
const loginScreen = $('loginScreen');
const signupScreen = $('signupScreen'); 
const dashboard = $('dashboard');
const mainContent = $('mainContent'); 
const createPostCard = $('createPostCard');

/* --- Render helpers --- */
function renderFeed(){
  const feed = $('feed');
  feed.innerHTML = '';
  // Only render posts for the currently selected group
  const posts = getPosts().filter(p => p.group === currentGroup).slice().reverse(); 
  
  if (currentGroup) {
      $('feedTitle').textContent = currentGroup;
  }
  
  if (posts.length === 0) {
      feed.innerHTML = '<p style="opacity: 0.7; padding: 10px 0;">No posts yet. Be the first to start the conversation!</p>';
      return;
  }
  
  posts.forEach((p, idx) => {
    const i = posts.length - 1 - idx; 
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>${p.user}</strong>
        <small style="opacity:0.8; font-size: 13px;">Likes: ${p.likes}</small>
      </div>
      <p style="margin-top:8px">${escapeHtml(p.content)}</p>
      <div style="margin-top:12px"><button class="group-btn join-btn" data-like-index="${i}" data-content-hash="${p.content.length}">Like</button></div>
    `;
    feed.appendChild(div);
  });
  
  // Re-attach like handlers
  document.querySelectorAll('[data-like-index]').forEach(btn=>{
    btn.onclick = (e)=>{
      const allPosts = getPosts();
      const targetGroup = currentGroup;
      
      const visiblePosts = allPosts.filter(p => p.group === targetGroup).slice().reverse();
      const idx = parseInt(btn.getAttribute('data-like-index'),10);
      const targetPost = visiblePosts[idx]; 
      
      const originalIndex = allPosts.findIndex(p => 
          p.content === targetPost.content && 
          p.user === targetPost.user && 
          p.group === targetPost.group
      );
      
      if (originalIndex !== -1) {
          allPosts[originalIndex].likes = (allPosts[originalIndex].likes || 0) + 1;
          savePosts(allPosts);
          renderFeed(); 
      }
    };
  });
}

function renderCommunities(){
  const list = $('communityList');
  list.innerHTML = '';
  const comms = getCommunities();
  const userGroups = getUserGroups();
  const userIsMember = (groupName) => currentUser ? (userGroups[groupName] || []).includes(currentUser) : false;

  const searchInput = $('groupSearchInput');
  const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
  
  let communitiesToDisplay = [];

  if (searchTerm === '') {
    // MODE 1: No search term - show ONLY joined groups
    const joinedGroupNames = Object.keys(userGroups).filter(groupName => userIsMember(groupName));
    communitiesToDisplay = comms.filter(c => joinedGroupNames.includes(c));
    
    if (communitiesToDisplay.length === 0) {
        list.innerHTML = '<li style="justify-content:center; background:none; cursor:default; color:#b1a4c8; padding: 20px 10px; border: none;">You haven\'t joined any groups yet. Search above to find some!</li>';
        return;
    }
    
  } else {
    // MODE 2: Search term active - show ALL groups that match the term
    communitiesToDisplay = comms.filter(c => c.toLowerCase().includes(searchTerm));
    
    if (communitiesToDisplay.length === 0) {
        list.innerHTML = '<li style="justify-content:center; background:none; cursor:default; color:#b1a4c8; padding: 20px 10px; border: none;">No groups found matching your search.</li>';
        return;
    }
  }

  // Render the list
  communitiesToDisplay.forEach(c=>{
    const li = document.createElement('li');
    li.innerHTML = `<span>${c}</span>`;

    if (currentUser) {
        if (userIsMember(c)) {
            const viewBtn = document.createElement('button');
            viewBtn.textContent = 'View Feed';
            viewBtn.className = 'group-btn view-btn';
            viewBtn.onclick = () => openGroupFeed(c);
            li.appendChild(viewBtn);
        } else {
            const joinBtn = document.createElement('button');
            joinBtn.textContent = 'Join';
            joinBtn.className = 'group-btn join-btn';
            joinBtn.onclick = () => joinGroup(c);
            li.appendChild(joinBtn);
        }
    } else {
        const joinBtn = document.createElement('button');
        joinBtn.textContent = 'Join';
        joinBtn.className = 'group-btn join-btn';
        joinBtn.onclick = () => alert('Please log in or sign up to join a group.');
        li.appendChild(joinBtn);
    }
    list.appendChild(li);
  });
}

/* Escape simple HTML in posts */
function escapeHtml(s){
  return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

/* --- Core Group/Feed Logic --- */
function joinGroup(groupName) {
  if (!currentUser) return alert('You must be logged in to join a group.');

  const userGroups = getUserGroups();
  if (!userGroups[groupName]) userGroups[groupName] = [];
  
  if (!userGroups[groupName].includes(currentUser)) {
    userGroups[groupName].push(currentUser);
    saveUserGroups(userGroups);
    alert(`You have joined ${groupName}!`);
    renderCommunities(); 
    openGroupFeed(groupName); 
  } else {
    alert(`You are already a member of ${groupName}.`);
  }
}

function openGroupFeed(name){
    if (!currentUser) return alert("Please log in to view the feed.");
    const userGroups = getUserGroups();
    if (!(userGroups[name] && userGroups[name].includes(currentUser))) {
        return alert("You must join this group before viewing its feed.");
    }

    currentGroup = name;
    mainContent.style.display = 'block'; 
    createPostCard.style.display = 'block'; 
    $('feedTitle').textContent = currentGroup; 
    renderFeed(); 
}


/* --- Auth & UI flow --- */
function showDashboardFor(userEmail){
  currentUser = userEmail;
  $('userEmail').textContent = userEmail;
  loginScreen.style.display = 'none';
  signupScreen.style.display = 'none'; 
  dashboard.style.display = 'block';
  dashboard.setAttribute('aria-hidden','false');
  
  mainContent.style.display = 'none'; 
  createPostCard.style.display = 'none'; 
  currentGroup = null; 
  
  renderCommunities(); 
  $('groupSearchInput').addEventListener('input', renderCommunities);
}

function showLogin(){
  currentUser = null;
  currentGroup = null;
  $('email').value = '';
  $('password').value = '';
  $('signupName').value = '';
  $('signupEmail').value = '';
  $('signupPass').value = '';
  $('signupConfirm').value = '';

  loginScreen.style.display = 'flex';
  signupScreen.style.display = 'none'; 
  dashboard.style.display = 'none';
  dashboard.setAttribute('aria-hidden','true');
}

function showSignup(){
    loginScreen.style.display = 'none';
    signupScreen.style.display = 'flex';
    dashboard.style.display = 'none';
}

/* --- Events: Login / Signup / Forgot / Logout --- */
$('loginBtn').addEventListener('click', function(){
  const email = $('email').value.trim();
  const pass = $('password').value;
  if(!email || !pass) return alert('Please fill email and password.');
  const user = getUsers().find(u=>u.email === email && u.password === pass);
  if(!user) return alert('Invalid email or password.');
  showDashboardFor(user.email);
});

$('createAccountBtn').addEventListener('click', showSignup);
$('signupClose').addEventListener('click', showLogin);

$('signupSubmit').addEventListener('click', function(){
  const name = $('signupName').value.trim();
  const email = $('signupEmail').value.trim();
  const pass = $('signupPass').value;
  const conf = $('signupConfirm').value;
  if(!name || !email || !pass) return alert('Please provide name, email and password.');
  if(pass !== conf) return alert('Passwords do not match.');
  const users = getUsers();
  if(users.some(u=>u.email === email)) return alert('User already exists.');
  users.push({name: name, email: email, password: pass});
  saveUsers(users);
  alert('Account created. You may now log in.');
  showLogin();
});

$('forgotPassword').addEventListener('click', function(){
  const email = prompt('Enter your email to reset password:');
  if(!email) return;
  const users = getUsers();
  const user = users.find(u=>u.email === email);
  if(!user) return alert('No account found with that email.');
  const np = prompt('Enter your new password:');
  if(!np) return;
  user.password = np;
  saveUsers(users);
  alert('Password updated. You may now log in.');
});

$('logoutBtn').addEventListener('click', function(){
  showLogin();
});

/* --- Posts --- */
$('postBtn').addEventListener('click', function(){
  const content = $('postContent').value.trim();
  if(!content) return alert('Post cannot be empty.');
  if(!currentGroup) return alert('Please select a group before posting.'); 

  const userGroups = getUserGroups();
  if (!(userGroups[currentGroup] && userGroups[currentGroup].includes(currentUser))) {
      return alert("You must join this group to post to its feed.");
  }
  
  const posts = getPosts();
  posts.push({ user: currentUser || 'Anonymous', content: content, likes: 0, group: currentGroup });
  savePosts(posts);
  $('postContent').value = '';
  renderFeed();
});

/* --- Communities / Groups --- */
$('createGroup').addEventListener('click', function(){
  if (!currentUser) return alert('You must be logged in to create a group.');
  const name = prompt('Enter study group name:');
  if(!name || name.trim() === '') return;
  const comms = getCommunities();
  if(comms.includes(name)) return alert('Group already exists.');
  comms.push(name);
  saveCommunities(comms);
  renderCommunities();
  joinGroup(name); // Auto-join and open the feed for the newly created group
});

/* Init render on page load */
(function init(){
  showLogin();
})();
</script>

</body>
</html>